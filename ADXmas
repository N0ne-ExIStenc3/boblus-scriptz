local link = "https://raw.githubusercontent.com/N0ne-ExIStenc3/boblus-scriptz/refs/heads/main/ADXmas"

if queue_on_teleport then
	queue_on_teleport(('loadstring(game:HttpGet("%s"))()'):format(link))
end

local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local VIM = game:GetService("VirtualInputManager")

local Values = RS:WaitForChild("Values")
local Events = RS:WaitForChild("Events")
local Player = Players.LocalPlayer

Values.GuiltySuspect.Value = ""

local Traits = {
	NICE = "XmasNice",
	NAUGHTY = "XmasNaughty",
	SNEAKY = "Sneaky",
	TARGET = "TargetAttack",
	DESTRUCTIVE = "Destructive",
	SHOE = "Shoe",
	PEEKER = "XmasPeeker",
	CREEPY = "Creepy",
}

local Suspects = {
	Bauble   = {Traits.NICE,    Traits.SNEAKY,     Traits.PEEKER},
	Catchy   = {Traits.NAUGHTY, Traits.SNEAKY,     Traits.PEEKER},
	Chuckle  = {Traits.NICE,    Traits.SNEAKY,     Traits.TARGET},
	Cocoa    = {Traits.NAUGHTY, Traits.SNEAKY,     Traits.TARGET},
	Fiddle   = {Traits.NICE,    Traits.SNEAKY,     Traits.DESTRUCTIVE},
	Giggles  = {Traits.NAUGHTY, Traits.SNEAKY,     Traits.DESTRUCTIVE},
	Icky     = {Traits.NICE,    Traits.SNEAKY,     Traits.CREEPY},
	Lamp     = {Traits.NAUGHTY, Traits.SNEAKY,     Traits.CREEPY},
	Merry    = {Traits.NICE,    Traits.PEEKER,     Traits.TARGET},
	Mittens  = {Traits.NAUGHTY, Traits.PEEKER,     Traits.TARGET},
	Noodle   = {Traits.NICE,    Traits.PEEKER,     Traits.DESTRUCTIVE},
	Pinky    = {Traits.NAUGHTY, Traits.PEEKER,     Traits.DESTRUCTIVE},
	Smarty   = {Traits.NICE,    Traits.PEEKER,     Traits.CREEPY},
	Snozzle  = {Traits.NAUGHTY, Traits.PEEKER,     Traits.CREEPY},
	Socks    = {Traits.NICE,    Traits.TARGET,     Traits.DESTRUCTIVE},
	Sprinkle = {Traits.NAUGHTY, Traits.TARGET,     Traits.DESTRUCTIVE},
	Star     = {Traits.NICE,    Traits.TARGET,     Traits.CREEPY},
	Sugarplum= {Traits.NAUGHTY, Traits.TARGET,     Traits.CREEPY},
	Tammy    = {Traits.NICE,    Traits.DESTRUCTIVE,Traits.CREEPY},
	Tin      = {Traits.NAUGHTY, Traits.DESTRUCTIVE,Traits.CREEPY},
	Tinsel   = {Traits.NICE,    Traits.SHOE,       Traits.CREEPY},
	Twinkle  = {Traits.NAUGHTY, Traits.SHOE,       Traits.TARGET},
	Vanilla  = {Traits.NICE,    Traits.SHOE,       Traits.PEEKER},
	Zomby    = {Traits.NAUGHTY, Traits.SHOE,       Traits.DESTRUCTIVE},
}

local function getTraits()
	local traits = {}

	local workshop = workspace.Map:FindFirstChild("Santa's Workshop")
	if workshop then
		local conveyor = workshop:FindFirstChild("ConveyorGiftItem")
		if conveyor then
			if conveyor.Value == "Coal" then
				table.insert(traits, Traits.NAUGHTY)
			else
				table.insert(traits, Traits.NICE)
			end
		end

		if workshop:FindFirstChild("HiddenEvidence") then
			table.insert(traits, Traits.SNEAKY)
		end

		if workshop:FindFirstChild("Wrecked") then
			table.insert(traits, Traits.DESTRUCTIVE)
		end
	end

	local active = workspace:FindFirstChild("ActiveEvidence")
	if active then
		local shoe = active:FindFirstChild("Shoe")
		if shoe then
			if shoe:FindFirstChild("ElfShoe") or (#shoe:GetChildren() > 0) then
				table.insert(traits, Traits.SHOE)
			end
		end
	end

	local debris = RS:FindFirstChild("Debris")
	if debris then
		local imagePart = debris:FindFirstChild("Image")
		if imagePart then
			local decal = imagePart:FindFirstChildWhichIsA("Decal")
			if decal and decal.Texture == "rbxassetid://73874117311257" then
				table.insert(traits, Traits.TARGET)
			end
		end

		if debris:FindFirstChild("OpenGifts") then
			table.insert(traits, Traits.PEEKER)
		end
	end

	while #traits < 3 do
		table.insert(traits, Traits.CREEPY)
	end

	return traits
end

local function findSuspect(traits)
	for name, suspectTraits in pairs(Suspects) do
		local matches = 0
		for _, t in ipairs(traits) do
			if table.find(suspectTraits, t) then
				matches += 1
			end
		end
		if matches == 3 then
			return name
		end
	end
	return nil
end

local function accuseAndRejoin()
	local traits = getTraits()
	local suspect = findSuspect(traits)
	if suspect then
		Values.GuiltySuspect.Value = suspect
		task.wait(1)
		Events.AccuseSuspect:FireServer(suspect)
	else
		Events.AccuseSuspect:FireServer("Bauble")
	end
	task.wait(12)
	Events.CreateParty:FireServer(1, "Santa's Workshop", "Friends")
	Events.RetryMap:FireServer()
end

local function clickPlayAgain()
	local cam = workspace.CurrentCamera
	local scr = cam.ViewportSize
	local x = scr.X / 2
	local y = scr.Y * 0.84
	VIM:SendMouseButtonEvent(x, y, 0, true, game, 0)
	task.wait(0.1)
	VIM:SendMouseButtonEvent(x, y, 0, false, game, 0)
end

task.spawn(function()
	repeat task.wait() until game:IsLoaded()
	task.wait(4)
	while true do
		local menuGui = Player.PlayerGui:FindFirstChild("MenuGui")
		if menuGui then
			clickPlayAgain()
			task.wait(2.5)
			accuseAndRejoin()
		end
		task.wait(0.5)
	end
end)
