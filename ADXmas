local link = "https://raw.githubusercontent.com/N0ne-ExIStenc3/boblus-scriptz/refs/heads/main/ADXmas"

if queue_on_teleport then
	queue_on_teleport(('loadstring(game:HttpGet("%s"))()'):format(link))
end

local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local VIM = game:GetService("VirtualInputManager")

local Values = RS:WaitForChild("Values")
local Events = RS:WaitForChild("Events")
local Player = Players.LocalPlayer

Values.GuiltySuspect.Value = ""

local Traits = {
	NICE = "XmasNice",
	NAUGHTY = "XmasNaughty",
	SNEAKY = "Sneaky",
	TARGET = "TargetAttack",
	DESTRUCTIVE = "Destructive",
	SHOE = "Shoe",
	PEEKER = "XmasPeeker",
	CREEPY = "Creepy",
}

local Suspects = {
	Bauble={Traits={Traits.NICE,Traits.SNEAKY,Traits.PEEKER}},
	Catchy={Traits={Traits.NAUGHTY,Traits.SNEAKY,Traits.PEEKER}},
	Chuckle={Traits={Traits.NICE,Traits.SNEAKY,Traits.TARGET}},
	Cocoa={Traits={Traits.NAUGHTY,Traits.SNEAKY,Traits.TARGET}},
	Fiddle={Traits={Traits.NICE,Traits.SNEAKY,Traits.DESTRUCTIVE}},
	Giggles={Traits={Traits.NAUGHTY,Traits.SNEAKY,Traits.DESTRUCTIVE}},
	Icky={Traits={Traits.NICE,Traits.SNEAKY,Traits.CREEPY}},
	Lamp={Traits={Traits.NAUGHTY,Traits.SNEAKY,Traits.CREEPY}},
	Merry={Traits={Traits.NICE,Traits.PEEKER,Traits.TARGET}},
	Mittens={Traits={Traits.NAUGHTY,Traits.PEEKER,Traits.TARGET}},
	Noodle={Traits={Traits.NICE,Traits.PEEKER,Traits.DESTRUCTIVE}},
	Pinky={Traits={Traits.NAUGHTY,Traits.PEEKER,Traits.DESTRUCTIVE}},
	Smarty={Traits={Traits.NICE,Traits.PEEKER,Traits.CREEPY}},
	Snozzle={Traits={Traits.NAUGHTY,Traits.PEEKER,Traits.CREEPY}},
	Socks={Traits={Traits.NICE,Traits.TARGET,Traits.DESTRUCTIVE}},
	Sprinkle={Traits={Traits.NAUGHTY,Traits.TARGET,Traits.DESTRUCTIVE}},
	Star={Traits={Traits.NICE,Traits.TARGET,Traits.CREEPY}},
	Sugarplum={Traits={Traits.NAUGHTY,Traits.TARGET,Traits.CREEPY}},
	Tammy={Traits={Traits.NICE,Traits.DESTRUCTIVE,Traits.CREEPY}},
	Tin={Traits={Traits.NAUGHTY,Traits.DESTRUCTIVE,Traits.CREEPY}},
	Tinsel={Traits={Traits.NICE,Traits.SHOE,Traits.CREEPY}},
	Twinkle={Traits={Traits.NAUGHTY,Traits.SHOE,Traits.TARGET}},
	Vanilla={Traits={Traits.NICE,Traits.SHOE,Traits.PEEKER}},
	Zomby={Traits={Traits.NAUGHTY,Traits.SHOE,Traits.DESTRUCTIVE}},
}

local function getTraits()
    local debris = RS:FindFirstChild("Debris")
	local traits = {}
	local map = workspace:FindFirstChild("Map")
	local workshop = map and map:FindFirstChild("Santa's Workshop")

	if workshop then
		local conveyor = workshop:FindFirstChild("ConveyorGiftItem")
		if conveyor then
			traits[#traits+1] = conveyor.Value == "Coal" and Traits.NAUGHTY or Traits.NICE
		end
		if workshop:FindFirstChild("HiddenEvidence") then traits[#traits+1] = Traits.SNEAKY end
		if workshop:FindFirstChild("Wrecked") then traits[#traits+1] = Traits.DESTRUCTIVE end
	end

	local active = workspace:FindFirstChild("ActiveEvidence")
	if active then
		local shoe = active:FindFirstChild("Shoe")
		if shoe then
			if shoe:FindFirstChild("ElfShoe") or #shoe:GetChildren() > 0 then
				traits[#traits+1] = Traits.SHOE
			end
		end

		local imgHolder = debris:FindFirstChild("Image")
		local img = imgHolder and imgHolder:FindFirstChild("Image").Decal
		if img and img.Image == "rbxassetid://73874117311257" then
			traits[#traits+1] = Traits.TARGET
		end

		local debris = RS:FindFirstChild("Debris")
		if debris and debris:FindFirstChild("OpenGifts") then
			traits[#traits+1] = Traits.PEEKER
		end
	end

	while #traits < 3 do traits[#traits+1] = Traits.CREEPY end
	return traits
end

local function findSuspect(traits)
	for name, data in next, Suspects do
		local m = 0
		for _, t in ipairs(traits) do
			if table.find(data.Traits, t) then m += 1 end
		end
		if m == 3 then return name end
	end
end

local function process()
	local suspect = findSuspect(getTraits())
	Values.GuiltySuspect.Value = suspect or ""
	return suspect
end

local function waitSuspect()
	local v = Values.GuiltySuspect
	repeat task.wait() until v.Value ~= ""
	return v.Value
end

local function doAction()
	process()
	task.wait(3)
	local s = waitSuspect()
	Events.AccuseSuspect:FireServer(s)
	task.wait(10)
	Events.CreateParty:FireServer(1, "Santa's Workshop", "Friends")
	Events.RetryMap:FireServer()
end

local function clickMenu()
	local cam = workspace.CurrentCamera
	local size = cam.ViewportSize
	local x, y = size.X * 0.5, size.Y * 0.84
	VIM:SendMouseButtonEvent(x, y, 0, true, game, 0)
	task.wait()
	VIM:SendMouseButtonEvent(x, y, 0, false, game, 0)
    task.wait(2)
    doAction()
end

task.spawn(function()
	repeat task.wait() until game:IsLoaded()
	task.wait(2)

	while task.wait(0.5) do
		local gui = Player.PlayerGui:FindFirstChild("MenuGui")
		if gui then
			clickMenu()
		end
	end
end)
