local TOOL_WAIT = {
	-- PICKS
	["Wood Pick"]        = {H=58, O=61},
	["Ice Pick"]         = {H=49, O=51},
	["Stone Pick"]       = {H=40, O=42},
	["Turquoise Pick"]   = {H=30, O=32},
	["Amethyst Pick"]    = {H=25, O=26},
	["Iron Pick"]        = {H=21, O=22},
	["Gold Pick"]        = {H=19, O=20},
	["Crystal Pick"]     = {H=16, O=17},
	["Rhodonite Pick"]   = {H=15, O=16},
	["Meteorite Pick"]   = {H=14, O=14},
	["Green Quartz Pick"]= {H=12, O=12},
	["Sapphire Pick"]    = {H=11, O=11},
	["Tanzanite Pick"]   = {H=10, O=11},
	["Apatite Pick"]     = {H=10, O=10},
	["Shell Pick"]       = {H=9,  O=9},
	["Ruby Pick"]        = {H=9,  O=9},
	["Topaz Pick"]       = {H=8,  O=9},
	["Titanium Pick"]    = {H=8,  O=8},
	["Jade Pick"]        = {H=8,  O=8},
	["Obsidian Pick"]    = {H=8,  O=8},
	["Fire Opal Pick"]   = {H=7,  O=8},
	["Hiddenite Pick"]   = {H=7,  O=7},
	["Olivine Pick"]     = {H=7,  O=7},
	["Serpentine Pick"]  = {H=7,  O=7},
	["Sodalite Pick"]    = {H=7,  O=7},
	["Spinel Pick"]      = {H=7,  O=7},

	-- DAMAGE TO ALL TOOLS
	["Rock"]                  = {H=90, O=95},
	["Star Club"]             = {H=16, O=17},
	["Jade Dragon Tool"]      = {H=8, O=8},
	["Legendary Hook"]        = {H=13,  O=13},
	["Lightning Tool"]        = {H=11,  O=11},
	["Valentines Tool"]       = {H=16,  O=17},
	["Gingerbread Cookie Tool"]={H=11, O=11},
	["Christmas Tree Tool"]   = {H=10,  O=10},
}

_G.tool = _G.tool
_G.pickupEnabled = false or _G.pickupEnabled
_G.webhookEnabled = false or _G.webhookEnabled
_G.discordWebhook = "" or _G.discordWebhook
_G.sellho = true or _G.sellho

_G.execCount = (_G.execCount or 0) + 1
_G.bh = _G.bh or 0
_G.bo = _G.bo or 0
_G.sh = _G.sh or 0
_G.so = _G.so or 0

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local PlaceId = game.PlaceId
local JobId = game.JobId

if not game:IsLoaded() then game.Loaded:Wait() end

local function getStat(name)
	local p = Player:FindFirstChild("PlayerData")
	local s = p and p:FindFirstChild("PRINCIPAL")
	return s and s:FindFirstChild(name) and s[name].Value
end

local function getOres(name)
	local p = Player:FindFirstChild("PlayerData")
	local m = p and p:FindFirstChild("Materials")
	return m and m:FindFirstChild(name) and m[name].Value
end

local function getDevice()
	if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
		return "Mobile"
	elseif UserInputService.KeyboardEnabled then
		return "PC"
	end
	return "Unknown"
end

local function getThumbnail()
	return ("https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=%d&size=150x150&format=Png"):format(Player.UserId)
end

local waitData = TOOL_WAIT[_G.tool] or {H=8,O=8}
local WAIT_H = waitData.H
local WAIT_O = waitData.O

local function sendWebhook(fields)
	if not (_G.webhookEnabled and _G.discordWebhook ~= "") then return end

	local payload = {
		username = "Farm Log",
		embeds = {{
			title = "Overall Stats",
			color = 65280,
			thumbnail = { url = getThumbnail() },
			fields = fields,
			footer = { text = "Execution #" .. _G.execCount },
			timestamp = DateTime.now():ToIsoDate()
		}}
	}

	local req = syn and syn.request or http_request or request
	if req then
		pcall(function()
			req({
				Url = _G.discordWebhook,
				Method = "POST",
				Headers = {["Content-Type"]="application/json"},
				Body = HttpService:JSONEncode(payload)
			})
		end)
	end
end

local Events = ReplicatedStorage:WaitForChild("Events")
Events.StartGame:FireServer()
task.wait(3)

local MineEvent = Events.Mine
local SetTool = Events.SetTool
local PickupEvent = Events.Pickup

local function getChar()
	return Player.Character or Player.CharacterAdded:Wait()
end

local function getHRP()
	return getChar():WaitForChild("HumanoidRootPart")
end

local function rejoin()
	if #Players:GetPlayers() <= 1 then
		Player:Kick("Rejoining...")
		task.wait()
		TeleportService:Teleport(PlaceId, Player)
	else
		TeleportService:TeleportToPlaceInstance(PlaceId, JobId, Player)
	end
end

task.spawn(function()
	while task.wait(0.25) do
		MineEvent:FireServer()
	end
end)

SetTool:FireServer(_G.tool)
task.spawn(function()
	while task.wait(2) do
		SetTool:FireServer(_G.tool)
	end
end)

local PICKUP_DELAY = 0.01
local PICKUP_DISTANCE = 15
local AllowedItems = {Coin=true,Experience=true,Hiddenite=true,Olivine=true}

local function getItemPosition(item)
	if item:IsA("BasePart") then return item.Position end
	if item:IsA("Model") then
		local p = item.PrimaryPart or item:FindFirstChildWhichIsA("BasePart", true)
		return p and p.Position
	end
end

task.spawn(function()
	while task.wait(PICKUP_DELAY) do
		if not _G.pickupEnabled then continue end
		local hrp = getHRP()
		local folder = workspace:FindFirstChild("Items")
		if not folder then continue end
		for _,item in ipairs(folder:GetChildren()) do
			if AllowedItems[item.Name] then
				local pos = getItemPosition(item)
				if pos and (hrp.Position - pos).Magnitude <= PICKUP_DISTANCE then
					pcall(function() PickupEvent:FireServer(item) end)
				end
			end
		end
	end
end)

local HPositions = {
	Vector3.new(465,-69,-631),
	Vector3.new(465,-68,-603),
	Vector3.new(382,-63,-597),
}
local OPositions = {
	Vector3.new(1157,-319,-597),
	Vector3.new(1136,-314,-616),
	Vector3.new(1113,-314,-605),
}

task.spawn(function()
	local hrp = getHRP()

	for _,p in ipairs(HPositions) do
		hrp.CFrame = CFrame.new(p)
		task.wait(WAIT_H)
	end

	for _,p in ipairs(OPositions) do
		hrp.CFrame = CFrame.new(p)
		task.wait(WAIT_O)
	end

	local beforeH = getOres("Hiddenite")
	local beforeO = getOres("Olivine")
	_G.bh, _G.bo = beforeH or _G.bh, beforeO or _G.bo

	sendWebhook({
		{name="ðŸ‘¤ User", value=Player.DisplayName.." ("..Player.Name..")", inline=false},
		{name="ðŸ†” User ID", value=Player.UserId, inline=true},
		{name="ðŸ“± Device", value=getDevice(), inline=true},
		{name="ðŸ“† Account Age", value=Player.AccountAge.." days", inline=true},
		{name="ðŸ•’ Time", value=os.date("%Y-%m-%d %H:%M:%S"), inline=false},
		{name="âš’ï¸ Tool", value=_G.tool, inline=true},
		{name="â±ï¸ Wait (H/O)", value=WAIT_H.." / "..WAIT_O.."s", inline=true},
		{name="ðŸ’° Coins", value=getStat("Coin") or "N/A", inline=true},
		{name="â­ Stars", value=getStat("Star") or "N/A", inline=true},
		{name="ðŸŸ¦ Hiddenite Total", value=_G.bh, inline=true},
		{name="ðŸŸ© Olivine Total", value=_G.bo, inline=true},
	})

	if _G.sellho then
		Events.Market:FireServer("Hiddenite",4)
		Events.Market:FireServer("Olivine",4)
	end

	task.wait(2.5)
	rejoin()
end)


if queue_on_teleport then
	queue_on_teleport([[
		loadstring(game:HttpGet("https://raw.githubusercontent.com/N0ne-ExIStenc3/boblus-scriptz/refs/heads/main/tllf3"))()
	]])
end
